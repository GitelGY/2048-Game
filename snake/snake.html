<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>SNAKE CONCERTO - FULL ORIGINAL VERSION</title>
    <style>
        :root {
            --bg: #1a1c2c; --panel: #292d3e; --accent: #7a88cf;
            --text: #efeeff; --canvas-bg: #121420; --grid: rgba(255,255,255,0.05);
        }
        body.theme-vintage { --bg: #edded2; --panel: #f9f4f0; --accent: #92400e; --text: #1e3a8a; --canvas-bg: #fffaf5; --grid: rgba(30, 58, 138, 0.08); }
        body.theme-forest { --bg: #2d3a3a; --panel: #3d4f4f; --accent: #a3c585; --text: #f0f4f0; --canvas-bg: #1e2626; --grid: rgba(163, 197, 133, 0.08); }

        body { display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background: var(--bg); font-family: 'Segoe UI', system-ui, sans-serif; color: var(--text); transition: 0.5s; overflow: hidden; }
        
        #game-container { 
            text-align: center; background: var(--panel); padding: 25px; border-radius: 35px; width: 550px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5); position: relative; border: 1px solid rgba(255,255,255,0.1);
        }
        
        .setup-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; text-align: right; }
        .setup-item { display: flex; flex-direction: column; gap: 5px; }
        .label { font-size: 13px; font-weight: bold; opacity: 0.8; margin-bottom: 3px; }

        .choice-row { display: flex; gap: 5px; flex-wrap: wrap; }
        .choice-btn { 
            padding: 5px 10px; border-radius: 8px; font-size: 11px; font-weight: bold; 
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); cursor: pointer; color: var(--text);
        }
        .choice-btn.active { background: var(--accent); color: white; box-shadow: 0 0 10px var(--accent); }
        
        .color-dot { width: 22px; height: 22px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .color-dot.active { border-color: white; transform: scale(1.3); box-shadow: 0 0 10px white; }

        input { padding: 12px; border-radius: 12px; border: none; width: 85%; background: rgba(0,0,0,0.2); color: white; font-size: 16px; outline: none; text-align: center; margin-bottom: 5px; border: 1px solid transparent; }
        
        #start-btn { padding: 16px; font-size: 18px; border-radius: 15px; background: var(--accent); border: none; cursor: pointer; font-weight: bold; color: white; width: 100%; margin-top: 15px; }

        #restart-same-btn{ padding: 16px; font-size: 18px; border-radius: 15px; background: var(--accent); border: none; cursor: pointer; font-weight: bold; color: white; width: 70%; margin-top: 15px; }


        canvas { background-color: var(--canvas-bg); display: none; margin: 15px auto; border-radius: 20px; border: 4px solid var(--accent); box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .stats { display: none; justify-content: space-between; align-items: center; padding: 0 10px; font-weight: bold; color: var(--accent); }
        
        #bonus-tag { position: absolute; top: 15px; right: 25px; color: #3498db; font-weight: bold; display: none; font-size: 18px; text-shadow: 0 0 10px #3498db; }
        #mute-btn { position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.1); border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; color: var(--text); z-index: 100; }
        
        #leaderboard { margin-top: 15px; background: rgba(0,0,0,0.15); border-radius: 15px; padding: 10px; }
        .high-score-item { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 13px; }
        
        #pause-overlay, #game-over { position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 50; border-radius: 35px; backdrop-filter: blur(8px); }
    </style>
</head>
<body>

<div id="game-container">
    <div id="bonus-tag">ğŸ”¥ ×‘×•× ×•×¡ X2: <span id="btimer">10</span></div>
    <button id="mute-btn" onclick="toggleMute()">ğŸ”Š</button>

    <div id="pause-overlay"><h2>×”×¤×¡×§×” â¸ï¸</h2><p>×œ×—×¥ <b>Space</b> ×œ×”××©×š</p></div>

    <div id="login-screen">
        <h1 style="margin: 0; font-size: 2.2em; color: var(--accent);">Snake ğŸ</h1>
        <input type="text" id="usernameInput" placeholder="×”×›× ×¡ ×©× ×©×—×§×Ÿ...">
        <div class="setup-grid">
            <div class="setup-item">
                <div class="label">×¢×™×¦×•×‘ ×¢×•×œ×:</div>
                <div class="choice-row">
                    <button class="choice-btn active" onclick="setTheme('default', this)">×œ×™×œ×”</button>
                    <button class="choice-btn" onclick="setTheme('vintage', this)">×•×™× ×˜××–'</button>
                    <button class="choice-btn" onclick="setTheme('forest', this)">×™×¢×¨</button>
                </div>
            </div>
            <div class="setup-item">
                <div class="label">×¨××ª ×§×•×©×™:</div>
                <div class="choice-row">
                    <button class="choice-btn active" onclick="setDiff(180, this)">×§×œ</button>
                    <button class="choice-btn" onclick="setDiff(120, this)">×¨×’×™×œ</button>
                    <button class="choice-btn" onclick="setDiff(75, this)">×§×©×”</button>
                </div>
            </div>
            <div class="setup-item">
                <div class="label">×¦×‘×¢ ×”× ×—×©:</div>
                <div class="choice-row">
                      <div class="color-dot active" style="background: #7a88cf;" onclick="setSColor('#7a88cf', this)"></div>
                    <div class="color-dot" style="background: #ef4444;" onclick="setSColor('#ef4444', this)"></div>
                    <div class="color-dot" style="background: #10b981;" onclick="setSColor('#10b981', this)"></div>
                    <div class="color-dot" style="background: #f59e0b;" onclick="setSColor('#f59e0b', this)"></div>
                    <div class="color-dot" style="background: #66ff00;" onclick="setSColor('#66ff00', this)"></div>
                    <div class="color-dot" style="background: #057e70;" onclick="setSColor('#057e70', this)"></div>
                    <div class="color-dot" style="background: #7700ff;" onclick="setSColor('#7700ff', this)"></div>
                    <div class="color-dot" style="background: #1e00ff;" onclick="setSColor('#1e00ff', this)"></div>
                    <div class="color-dot" style="background: #f50be2;" onclick="setSColor('#f50be2', this)"></div>
                </div>
            </div>
        </div> 
        <div id="leaderboard"><div class="label" style="text-align: center;">ğŸ† ×˜×‘×œ×ª ×©×™××™×</div><div id="scores-list"></div></div>
        <button id="start-btn" onclick="login()">×”×ª×—×œ ××©×—×§</button>
        <p style="font-size:0.7em;">Â©ï¸ G.Goldberg-0548441432</p>
    </div>

    <div id="game-over">
        <h2 style="color: #ff4757; font-size: 2.5em;">×”××©×—×§ × ×’××¨</h2>
        <p id="final-score" style="font-size: 1.2em;"></p>
        <div id="game-over-board" style="width: 80%; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 20px; margin-bottom: 20px;"></div>
        <button id="restart-same-btn" onclick="restartSameGame()" >×©×—×§ ×©×•×‘</button>
    </div>

    <div class="stats" id="stats">
        <div>× ×™×§×•×“: <span id="scoreVal" style="font-size: 1.5em;">0</span></div>
        <div id="user-display" style="opacity: 0.7;"></div>
        <div id="timerVal">00:00</div>
    </div>
    <canvas id="snakeGame" width="400" height="400"></canvas>
</div>

<script>
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let baseSpeed = 180, isMuted = false, gameStarted = false, isPaused = false;
    let currentUser, sColor = "#7a88cf", score = 0, snake, food, blueFood, yellowFood, d, nextD, walls = [];
    let bonusActive = false, bonusTime = 0, bonusInterval, frameCount = 0;
    let blueTimer = 0, yellowTimer = 0, particles = [], floatingTexts = [];

    const canvas = document.getElementById("snakeGame"), ctx = canvas.getContext("2d"), box = 20;

    function getHighScores() { return JSON.parse(localStorage.getItem('snakeHighScores')) || []; }
    
    function saveScore(name, score) {
        let scores = getHighScores(); 
        scores.push({name, score});
        scores.sort((a, b) => b.score - a.score);
        localStorage.setItem('snakeHighScores', JSON.stringify(scores.slice(0, 5)));
        // ×¢×“×›×•×Ÿ ××•×˜×•××˜×™ ×©×œ ×”×˜×‘×œ×” ××™×“ ×œ××—×¨ ×”×©××™×¨×”
        displayLeaderboards();
    }

    function displayLeaderboards() {
        const scores = getHighScores();
        const html = scores.length ? scores.map((s, i) => `<div class="high-score-item"><span>${i+1}. ${s.name}</span><b>${s.score}</b></div>`).join('') : "××™×Ÿ ×©×™××™× ×¢×“×™×™×Ÿ";
        document.getElementById('scores-list').innerHTML = html;
        document.getElementById('game-over-board').innerHTML = html;
    }

    function playTone(freq, dur) {
        if (isMuted) return;
        const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + dur);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + dur);
    }

    function createParticles(x, y, color) {
        for(let i=0; i<8; i++) particles.push({x: x+10, y: y+10, vx: (Math.random()-0.5)*5, vy: (Math.random()-0.5)*5, life: 1, color: color});
    }

    function addFloatingText(x, y, text, color) { floatingTexts.push({ x, y, text, color, life: 1 }); }

    function drawApple(x, y, color, timerPercent) {
        const pulse = Math.sin(frameCount * 0.1) * 1.5;
        ctx.fillStyle = "rgba(0,0,0,0.2)"; ctx.beginPath(); ctx.ellipse(x+10, y+17, 7, 3, 0, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = color; ctx.beginPath(); ctx.arc(x+10, y+10, 8+pulse, 0, Math.PI*2); ctx.fill();
        ctx.strokeStyle = "#4a2c2a"; ctx.lineWidth = 1.5; ctx.beginPath(); ctx.moveTo(x+10, y+5); ctx.lineTo(x+10, y+2); ctx.stroke();
        ctx.fillStyle = "#2ecc71"; ctx.beginPath(); ctx.ellipse(x+12, y+3, 3, 1.5, 0.5, 0, Math.PI*2); ctx.fill();
        if (timerPercent > 0) {
            ctx.strokeStyle = color; ctx.lineWidth = 2; ctx.beginPath(); ctx.arc(x+10, y+10, 15, -Math.PI/2, (-Math.PI/2) + (Math.PI*2 * timerPercent)); ctx.stroke();
        }
    }

    function setTheme(t, el) { document.body.className = t === 'default' ? '' : 'theme-' + t; updateActive(el); }
    function setDiff(s, el) { baseSpeed = s; updateActive(el); }
    function setSColor(c, el) { sColor = c; document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active')); el.classList.add('active'); }
    function updateActive(el) { Array.from(el.parentElement.children).forEach(b => b.classList.remove('active')); el.classList.add('active'); }
    function toggleMute() { isMuted = !isMuted; document.getElementById("mute-btn").innerText = isMuted ? "ğŸ”‡" : "ğŸ”Š"; }

    function login() {
        currentUser = document.getElementById("usernameInput").value || "×©×—×§×Ÿ";
        document.getElementById("login-screen").style.display = "none";
        document.getElementById("stats").style.display = "flex";
        document.getElementById("user-display").innerText = currentUser;
        canvas.style.display = "block";
        displayLeaderboards(); // ××•×•×“× ×©×”×˜×‘×œ×” ××¢×•×“×›× ×ª ×‘×ª×—×™×œ×ª ×”××©×—×§
        startGame();
    }

    function startGame() {
        snake = [{x: 10*box, y: 10*box}, {x: 9*box, y: 10*box}];
        walls = []; for(let i=0; i<6; i++) walls.push({x: Math.floor(Math.random()*19)*box, y: Math.floor(Math.random()*19)*box});
        food = getSafePos(); d = "RIGHT"; nextD = "RIGHT"; run();
    }

    function run() {
        frameCount++;
        draw(); if(gameStarted && !isPaused) update();
        if(document.getElementById("game-over").style.display !== "flex") setTimeout(run, baseSpeed);
    }

    function draw() {
        ctx.clearRect(0,0,400,400);
        ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--grid');
        for(let i=0; i<=400; i+=box) {
            ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,400); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(400,i); ctx.stroke();
        }
        particles.forEach((p, i) => {
            p.x+=p.vx; p.y+=p.vy; p.life-=0.02; if(p.life<=0) particles.splice(i,1);
            ctx.globalAlpha=p.life; ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,2,2);
        });
        ctx.globalAlpha=1;
        walls.forEach(w => { ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--accent'); ctx.fillRect(w.x+2, w.y+2, 16, 16); });
        drawApple(food.x, food.y, "#ff4757", 0);
        if(blueFood) drawApple(blueFood.x, blueFood.y, "#3498db", blueTimer/100);
        if(yellowFood) drawApple(yellowFood.x, yellowFood.y, "#f1c40f", yellowTimer/70);
        snake.forEach((s, i) => {
            ctx.fillStyle = i === 0 ? sColor : sColor + "aa";
            ctx.beginPath(); ctx.arc(s.x+10, s.y+10, i===0?11:9, 0, Math.PI*2); ctx.fill();
            if(i === 0) {
                ctx.fillStyle = "white";
                let ex = (d === "LEFT" ? -3 : d === "RIGHT" ? 3 : 0), ey = (d === "UP" ? -3 : d === "DOWN" ? 3 : 0);
                ctx.beginPath(); ctx.arc(s.x+6+ex, s.y+7+ey, 3, 0, Math.PI*2); ctx.arc(s.x+14+ex, s.y+7+ey, 3, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = "black";
                ctx.beginPath(); ctx.arc(s.x+6+ex*1.2, s.y+7+ey*1.2, 1.5, 0, Math.PI*2); ctx.arc(s.x+14+ex*1.2, s.y+7+ey*1.2, 1.5, 0, Math.PI*2); ctx.fill();
                if(frameCount % 20 < 10) {
                    ctx.strokeStyle = "red"; ctx.lineWidth = 2; ctx.beginPath();
                    let lx = (d === "LEFT" ? -5 : d === "RIGHT" ? 5 : 0), ly = (d === "UP" ? -5 : d === "DOWN" ? 5 : 0);
                    ctx.moveTo(s.x+10+lx, s.y+10+ly); ctx.lineTo(s.x+10+lx*2, s.y+10+ly*2); ctx.stroke();
                }
            }
        });
        floatingTexts.forEach((ft, i) => {
            ft.y-=1; ft.life-=0.02; if(ft.life<=0) floatingTexts.splice(i,1);
            ctx.globalAlpha=ft.life; ctx.fillStyle=ft.color; ctx.font="bold 12px Arial"; ctx.fillText(ft.text, ft.x, ft.y);
        });
        ctx.globalAlpha=1;
    }

    function update() {
        d = nextD; let hX = snake[0].x, hY = snake[0].y;
        if(d==="LEFT") hX-=box; if(d==="UP") hY-=box; if(d==="RIGHT") hX+=box; if(d==="DOWN") hY+=box;
        if(hX<0) hX=380; else if(hX>=400) hX=0; if(hY<0) hY=380; else if(hY>=400) hY=0;

        if(blueFood) { blueTimer--; if(blueTimer<=0) blueFood=null; }
        if(yellowFood) { yellowTimer--; if(yellowTimer<=0) yellowFood=null; }

        if(walls.some(w=>w.x===hX && w.y===hY) || snake.some(s=>s.x===hX && s.y===hY)) { 
            saveScore(currentUser, score);
            playTone(150, 0.4);
            document.getElementById("game-over").style.display="flex";
            document.getElementById("final-score").innerText = "×”×©×’×ª " + score + " × ×§×•×“×•×ª!";
            return;
        }

        if(hX===food.x && hY===food.y) {
            let p = bonusActive ? 2 : 1; score += p; food=getSafePos(); playTone(440,0.1); createParticles(hX, hY, "#ff4757");
            if(Math.random()<0.02) { blueFood=getSafePos(); blueTimer=100; }
            if(Math.random()<0.05) { yellowFood=getSafePos(); yellowTimer=70; }
        } else if(blueFood && hX===blueFood.x && hY===blueFood.y) {
            blueFood=null; blueTimer=0;
            bonusActive=true; bonusTime=10;
            document.getElementById("bonus-tag").style.display="block";
            addFloatingText(hX, hY, "SHORT & X2!", "#3498db");
            if(bonusInterval) clearInterval(bonusInterval);
            bonusInterval = setInterval(()=>{
                bonusTime--; document.getElementById("btimer").innerText=bonusTime;
                if(bonusTime<=0) { bonusActive=false; document.getElementById("bonus-tag").style.display="none"; clearInterval(bonusInterval); }
            },1000);
            for(let i=0; i<3; i++) if(snake.length>2) snake.pop();
            playTone(660,0.2); createParticles(hX, hY, "#3498db");
        } else if(yellowFood && hX===yellowFood.x && hY===yellowFood.y) {
            let p = (bonusActive ? 10 : 5); score+=p; yellowFood=null; yellowTimer=0;
            addFloatingText(hX, hY, "+" + p + " GOLD!", "#f1c40f");
            playTone(880,0.2); createParticles(hX, hY, "#f1c40f");
        } else { snake.pop(); }

        snake.unshift({x:hX, y:hY});
        document.getElementById("scoreVal").innerText = score;
    }

    function getSafePos() {
        let p; while(true) { p={x:Math.floor(Math.random()*19)*box, y:Math.floor(Math.random()*19)*box}; if(!snake.some(s=>s.x===p.x && s.y===p.y) && !walls.some(w=>w.x===p.x && w.y===p.y)) return p; }
    }

    document.addEventListener("keydown", e => {
        if(e.code === "Space") { e.preventDefault(); isPaused = !isPaused; document.getElementById("pause-overlay").style.display = isPaused ? "flex" : "none"; }
        const keys = {37:"LEFT", 38:"UP", 39:"RIGHT", 40:"DOWN"};
        if(keys[e.keyCode]) {
            if(!gameStarted) { gameStarted=true; }
            let nD = keys[e.keyCode];
            if(nD==="LEFT"&&d!=="RIGHT" || nD==="UP"&&d!=="DOWN" || nD==="RIGHT"&&d!=="LEFT" || nD==="DOWN"&&d!=="UP") nextD=nD;
        }
    });

    displayLeaderboards();

    function restartSameGame() {
        score = 0; snake = []; food = null; blueFood = null; yellowFood = null; walls = []; particles = []; floatingTexts = [];
        bonusActive = false; bonusTime = 0; blueTimer = 0; yellowTimer = 0; frameCount = 0; gameStarted = false; isPaused = false;
        if (bonusInterval) clearInterval(bonusInterval);
        document.getElementById("bonus-tag").style.display = "none";
        document.getElementById("pause-overlay").style.display = "none";
        document.getElementById("game-over").style.display = "none";
        document.getElementById("scoreVal").innerText = "0";
        document.getElementById("btimer").innerText = "10";
        document.getElementById("user-display").innerText = currentUser;
        startGame();
    }
</script>
</body>
</html>